---
title: "R Preliminary"
author: "Chia Jung, Yeh\\\n National Yang Ming Chiao Tung University (NYCU), Taiwan"
date: "`r Sys.Date()`"
output:
  bookdown::html_document2:
    css:
    - stylebox.css
    toc: TRUE
    toc_depth: 3
    toc_float:
      collapsed: TRUE
      smooth_scroll: FALSE
    theme: lumen
---

<style type="text/css">

body{
font-size: 16px;
font-family:"Georgia","標楷體",Serif;
}
td {  /* Table  */
  font-size: 18px;
  font-family:Georgia,"標楷體",Serif;
}
h1.title {
  font-size: 38px;
  color: DarkRed;
  font-family:Georgia,"標楷體",Serif;
}
h1 { /* Header 1 */
  font-size: 24px;
  font-family:Georgia,"標楷體",Serif;
  color: DarkBlue;
}
h2 { /* Header 2 */
    font-size: 22px;
    font-family:Georgia,"標楷體",Serif;
    color: DarkBlue;
}
h3 { /* Header 3 */
  font-size: 18px;
  font-family:Georgia,"標楷體",Serif;
  color: DarkBlue;
}
code.r{ /* Code block */
    font-size: 12px;
}
pre { /* Code block - determines code spacing between lines */
    font-size: 14px;
}
.blogbody{
font-size:17px;
  font-family:Georgia,"標楷體",Serif;
line-height: 150%;
}
</style>


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
library(jsonlite)
library(sf)
library(knitr)
library(kableExtra)
library(TWspdata)
```


<p style="color:#003D79;font-size:16px">**[This notebook would introduce the basic syntax of R Programming.]**</p>


# **Object**

Object is the type of data. Commonly used object includes:  

1.  vector  
2.  factor
3.  matrix   
4.  data frame
5.  list 


## **Vector**
<p style="color:#003D79;font-size:18px;line-height:2">**⌾ Features of vector**</p>  

* a combination of values
* one-dimensional
* it can be numeric, character or logical

<p style="color:#003D79;font-size:18px;line-height:2">**⌾ Use `c()` to create a vector**</p>  

* Numeric vector
```{r vector1, echo=T, eval=F}
vec1=c(1,2,3,4,5)
```

```{r vector1-show, echo=F, eval=T}
vec1=c(1,2,3,4,5)
vec1
```

* Character vector
```{r vector2, echo=T, eval=F}
vec2=c("A","B","C","D","E")
```

```{r vector2-show, echo=F, eval=T}
vec2=c("A","B","C","D","E")
vec2
```

* Logical vector
```{r vector3, echo=T, eval=F}
vec3=c(T,F,T,F,T)
```

```{r vector3-show, echo=F, eval=T}
vec3=c(T,F,T,F,T)
vec3
```

<p style="color:#003D79;font-size:18px;line-height:2">**⌾ Retrieve the specific elements**</p>  

* Retrieve the third element in `vec2`.
```{r vector-retrieve1, echo=T, eval=T}
vec2[3]
```

* Retrieve multiple elements in `vec2`.  
(continuous elements)   
```{r vector-retrieve2, echo=T, eval=T}
vec2[2:4]
```

* Retrieve multiple elements in `vec2`.  
(non-continuous elements)
```{r vector-retrieve3, echo=T, eval=T}
vec2[c(1,3,5)]
```

<p style="color:#003D79;font-size:18px;line-height:2">**⌾ Create sequential numeric vector**</p> 

```{r vector-continuous1, echo=T, eval=T}
seq(from=2, to=20, by=2)
```

<p style="color:#003D79;font-size:18px;line-height:2">**⌾ Operations on vectors**</p>  

Let us set a numeric vector first.  
```{r vector-exg, echo=T, eval=T}
vec4=c(1,9,3,15,6,2,8,12)
```

* Maximum & Minimum & Range
```{r vector-max-min, echo=T, eval=T}
max(vec4)
min(vec4)
range(vec4)
```

* Sum & Mean & median & Product
```{r vector-sum-mean, echo=T, eval=T}
sum(vec4)
mean(vec4)
median(vec4)
prod(vec4)
```

* Variance & Standard deviation
```{r vector-std-var, echo=T, eval=T}
var(vec4)
sd(vec4)
```

* Length  
number of elements in the vector  
```{r vector-length, echo=T, eval=T}
length(vec4)
```

* Order & Sort  
sort would rearrange the sequence by ascending  
order would retrieve the index of ascending sequence  
```{r vector-sort-order, echo=T, eval=T}
sort(vec4)
order(vec4)
```

<p style="color:#CE0000;font-size:14px;line-height:1">**See the result of `order()` above. It shows that the last value is "4", which means that the index of largest value is "4", that is, `vec4[4]` (15).**</p>  


<p style="color:#003D79;font-size:18px;line-height:2">**⌾ Calculations with vectors**</p>  

Let us use `vec4` and set a new numeric vector `vec5`.  
```{r vector-vec5, echo=T, eval=T}
vec5=c(2,5,8,11,7,4,10,3)
```

* Arithmetic    
add/ multiple two vectors  
<p style="color:#CE0000;font-size:14px;line-height:1">**Note that the lengths of the vectors should be the same while doing the calculations!**</p>  
```{r vector-addition1, echo=T, eval=T}
vec4+vec5
vec4*vec5
```

* Arithmetic  
add/ multiple a value to all the elements in the vector  
```{r vector-addition2, echo=T, eval=T}
vec5+5
vec5*5
```

<p style="color:#003D79;font-size:18px;line-height:2">**⌾ Convert data type**</p>  
* From character to numeric.  
<p style="color:#CE0000;font-size:14px;line-height:1">**Note that sometimes we may get a "character" type of number when importing the data. We should convert them into "numeric" type in advance, so as to do calculations.**</p>  
```{r vector-convert1, echo=T, eval=T}
vec_cha=c("1","2","3","4","5")
```

* Use `class()` to check out the data type.  

```{r vector-convert2, echo=T, eval=T}
class(vec_cha)
```

* Convert it by function `as.numeric()`.  
```{r vector-convert3, echo=T, eval=T}
as.numeric(vec_cha)
```

Also, we can convert the numeric to character as well. Use the function `as.character()`.  



## **Factor**
<p style="color:#003D79;font-size:18px;line-height:2">**⌾ Features of factor**</p>  

* converted from the character vector  
* should set the levels  
* setting a factor is very useful when adjusting the sequence of legend in `ggplot2`  

<p style="color:#003D79;font-size:18px;line-height:2">**⌾ Use `factor()` to create a factor**</p>  

* Function & Argument
```{r factor1, echo=T, eval=F}
factor(c(...), levels=c(...))
```

Let us set a vector of the schools:  
```{r factor2, echo=T, eval=T}
school=c("University","Kindergarten","Elementary","High","Junior High")
```

We know that the sequence should be Kindergarten >> Elementary >> Junior High >> High >> University.

* Use `factor()` to set their levels.  
```{r factor3, echo=T, eval=T}
school=factor(school, levels=c("Kindergarten","Elementary","Junior High","High","University"))
```

```{r factor4, echo=F, eval=T}
school
```

<p style="color:#003D79;font-size:18px;line-height:2">**⌾ Check if `school` is the factor**</p>  

```{r factor5, echo=T, eval=T}
is.factor(school)
class(school)
```

<p style="color:#003D79;font-size:18px;line-height:2">**⌾ Calculate number of elements in each level**</p>  

```{r factor6, echo=T, eval=T}
summary(school)
```

<p style="color:#003D79;font-size:18px;line-height:2">**⌾ Convert factor to numeric**</p>  

* Use `as.numeric()` to transform the factor to numeric  
```{r factor7, echo=T, eval=T}
as.numeric(school)
```

The numeric retrived above represents the level of each elements.  


## **Matrix**
<p style="color:#003D79;font-size:18px;line-height:2">**⌾ Features of matrix**</p>  

* contains multiple rows and columns 
* combination of multiple vectors with the same types (numeric, character or logical)  

<p style="color:#003D79;font-size:18px;line-height:2">**⌾ Use `matrix()` to create a matrix**</p>  

* Function & Argument
  * `nrow=` means number of rows in the matrix  
  * `ncol=` means number of columns in the matrix  
```{r matrix-function, echo=T, eval=F}
matrix(c(...), nrow=, ncol=)
```

```{r matrix1, echo=T, eval=F}
mat1=matrix(c(1:15), nrow=3, ncol=5)
```

```{r matrix1-show, echo=F, eval=T}
mat1=matrix(c(1:15), nrow=3, ncol=5)
mat1
```

See the result above, the original vector (`c(1:15)`) is filled by columns. What if we want it by row?

* Set argument `byrow=T`

```{r matrix2, echo=T, eval=F}
mat2=matrix(c(1:15), nrow=3, ncol=5, byrow=T)
```

```{r matrix2-show, echo=F, eval=T}
mat2=matrix(c(1:15), nrow=3, ncol=5, byrow=T)
mat2
```


<p style="color:#003D79;font-size:18px;line-height:2">**⌾ Check out the number of rows, columns and dimension of matrix**</p>  

```{r matrix3, echo=T, eval=T}
nrow(mat2)
ncol(mat2)
dim(mat2)
```

<p style="color:#003D79;font-size:18px;line-height:2">**⌾ Retrieve the specific elements in the matrix**</p>  

The index of row should be set at first, and then set the index of column.  
```{r matrix4, echo=T, eval=T}
mat2[2, 4]
```


<p style="color:#003D79;font-size:18px;line-height:2">**⌾ Transpose the matrix**</p>  

```{r matrix5, echo=T, eval=T}
t(mat2)
```


<p style="color:#003D79;font-size:18px;line-height:2">**⌾ Calculations on matrix**</p>  

* Sum of each row/ column
```{r matrix6, echo=T, eval=T}
rowSums(mat2)
colSums(mat2)
```

* Mean of each row/ column
```{r matrix7, echo=T, eval=T}
rowMeans(mat2)
colMeans(mat2)
```


## **data frame**

<p style="color:#003D79;font-size:18px;line-height:2">**⌾ Features of data frame**</p>  

* like a matrix but can have columns with different types  
* works like a spreadsheet (Excel)
* commonly used in data analysis
* can be tidy by the package `dplyr` (see [Section 2](#tidy-data))


<p style="color:#003D79;font-size:18px;line-height:2">**⌾ Use `data.frame()` to create a data frame**</p>  

* Function & Argument

```{r dataframe-function, echo=T, eval=F}
data.frame(A=c(), B=c(), C=c())
```

`A`, `B`, and `C` in the function represent the colname of the table.  


```{r dataframe1, echo=T, eval=T}
StuScore=data.frame(StudentID=c("ID1","ID2","ID3","ID4","ID5"),
           Name=c("Bob","Mary","Robert","Jason","Jane"),
           Score=c(60,80,40,50,100))
```

```{r dataframe1-show, echo=F, eval=T}
StuScore
```

<p style="color:#003D79;font-size:18px;line-height:2">**⌾ Check out the colnames of data frame**</p>  
```{r dataframe2, echo=T, eval=T}
colnames(StuScore)
```

<p style="color:#003D79;font-size:18px;line-height:2">**⌾ Retrieve specific rows/ columns**</p>  

* Retrieve rows  
place the index in front of the comma
```{r dataframe3, echo=T, eval=T}
StuScore[c(1,3,5),]
```

* Retrieve columns  
place the index after the comma
```{r dataframe4, echo=T, eval=T}
StuScore[, c(1,2)]
```

* Retrieve single column by `data$column_name`  
```{r dataframe5, echo=T, eval=T}
StuScore$Name
```

<p style="color:#003D79;font-size:18px;line-height:2">**⌾ Retrieve specific element**</p>  

* Set the index of row and column  
`data[row_index, column_index]`
```{r dataframe6, echo=T, eval=T}
StuScore[2,2]
```

* Edit the element by giving value  
```{r dataframe7, echo=T, eval=T}
StuScore[2,2]="Jessica"

# check out the new data
StuScore
```


<p style="color:#003D79;font-size:18px;line-height:2">**⌾ Check out the first/ last 6 rows of data**</p>  

Here we use the data `iris` provided by the R base. `iris` is a well-known data set that consists of 50 samples from each of three species of Iris flower (setosa, virginica, and versicolor). The columms include the length and the width of the sepals and petals (5 columns in total).  

* Use `head()` to retrieve the first 6 rows  
```{r dataframe_head, echo=T, eval=T}
head(iris)
```

* Use `tail()` to retrieve the last 6 rows  
```{r dataframe_tail, echo=T, eval=T}
tail(iris)
```


<p style="color:#003D79;font-size:18px;line-height:2">**⌾ Extend the data frame**</p>  

Back to our `StuScore` example. If we want to add attributes of a new student (add new row):

* Use `rbind()` to add new rows  
```{r dataframe_rbind, echo=T, eval=T}
# first create a new data
new_student=data.frame(StudentID="ID6", Name="Bob", Score=90)

# use rbind to merge data
StuScore=rbind(StuScore, new_student)

# check out the new data
StuScore
```

Then, if we want to add a new attribute (e.g., Gender) for all students (add new column):

* Use `cbind()` to add new columns  
```{r dataframe_cbind, echo=T, eval=T}
# first create a new data
Gender=c("M","F","M","M","F","M")

# use cbind to merge data
StuScore=cbind(StuScore, Gender)

# check out the new data
StuScore
```

Or it can simply add by using: `data$new_column=c(...)`
```{r dataframe_add_col, echo=T, eval=T}
StuScore$Height=c(180,165,170,160,175,180)

# check out the new data
StuScore
```


## **list**

<p style="color:#003D79;font-size:18px;line-height:2">**⌾ Features of list**</p>  

* collection of objects, which can be vector, matrix, or data frame  
* most complicated, and often used in the data format of the model result  


<p style="color:#003D79;font-size:18px;line-height:2">**⌾ Use `list()` to create a list**</p>  

```{r list1, echo=T, eval=T}
StuScore_list=list(StudentID=c("ID1","ID2","ID3","ID4","ID5"),
           Name=c("Bob","Mary","Robert","Jason","Jane"),
           Score=c(60,80,40,50,100),
           Class="A")
```

```{r list1-show, echo=F, eval=T}
StuScore_list
```


<p style="color:#003D79;font-size:18px;line-height:2">**⌾  Retrieve the attribute of list**</p>  

* Use `list$NAME` to retrieve  
```{r list2, echo=T, eval=T}
StuScore_list$Score
```

* Use index to retrieve  
```{r list3, echo=T, eval=T}
StuScore_list[[2]]
```



# **Tidy data**
The package commonly used to tidy data frame is `dplyr`. Please install and import the package via the following code:  

```{r install-dplyr, echo=T, eval=F}
# install the package
install.packages("dplyr")

# import the package
library(dplyr)
```

Functions that would be introduced in this section are summarized in Table \@ref(tab:function-dplyr).  

<!-- ```{r function-dplyr, echo=F, eval=T} -->
<!-- fuc=data.frame(Functions=c("`select()`","`filter()`","`mutate()`","`group_by()`","`summarise()`","`left_join()`","`arrange()`","`rename()`","`distinct()`"), Usage=c("[交通部道路路口定位服務](https://link.motc.gov.tw/swagger/ui/index#!/Node/Node_GetInterCityCNodeID)<br>請點[此處](https://github.com/ChiaJung-Yeh/R-Code-Sharing/raw/main/road_intersections/intersection_data.zip)直接下載所有資料，並解壓縮", '請安裝`TWspdata`套件<br>`install.packages("devtools")`<br>`devtools::install_github("ChiaJung-Yeh/TWspdata")`<br>`library(TWspdata)`<br>載入套件後，請使用`taiwan_village`資料')) -->
<!-- colnames(data_need)=c("資料","來源") -->
<!-- kbl(data_need, booktabs=T, escape=F, caption="Vital Functions in `dplyr`")%>% -->
<!--   kable_styling(bootstrap_options=c("striped", "hover"), font_size=18) -->
<!-- ``` -->
